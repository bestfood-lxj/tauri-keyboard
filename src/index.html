<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="styles.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Tauri App - Local Assets Test</title>
        <script type="module" src="/main.js" defer></script>
        <script>
            const { invoke } = window.__TAURI__.core;
        </script>
    </head>

    <body>
        <main class="container">
            <h1>Welcome to Tauri - Local Assets Test</h1>

            <div class="row">
                <a href="/assets/keybind-test.html">
                    <img
                        src="/assets/test.svg"
                        class="logo tauri"
                        alt="test logo"
                    />
                </a>
                <a href="http://192.168.1.159/qwerty-learner/">
                    <img
                        src="/assets/tauri.svg"
                        class="logo tauri"
                        alt="Tauri logo"
                    />
                </a>
                <a href="https://typewords.cc/">
                    <img
                        src="/assets/tauri.svg"
                        class="logo tauri"
                        alt="Tauri logo"
                    />
                </a>
            </div>

            <div class="local-assets-test">
                <h2>Local Assets Testing</h2>
                <h2><a href="http://myapp.localhost">http://myapp.localhost</a></h2>
                <h2><a href="http://127.0.0.1:3000/">http://127.0.0.1:3000/</a></h2>
                <h2><a href="https://127.0.0.1:3000/">https://127.0.0.1:3000/</a></h2>
                <p>Test local assets from different hosts:</p>

                <div class="host-buttons">
                    <button onclick="testLocalhost()">
                        Test localhost:3000
                    </button>
                    <button onclick="testIpHost()">Test 127.0.0.1:3000</button>
                    <button onclick="testWithTauriCommand()">
                        Test via Rust Command
                    </button>
                </div>

                <div id="test-results">
                    <h3>Test Results:</h3>
                    <div id="localhost-results" class="results-section">
                        <h4>localhost:3000 Results:</h4>
                        <div id="localhost-content"></div>
                    </div>
                    <div id="ip-results" class="results-section">
                        <h4>127.0.0.1:3000 Results:</h4>
                        <div id="ip-content"></div>
                    </div>
                </div>
            </div>

            <p>Click on the Tauri logo to learn more about the framework</p>

            <p id="greet-msg"></p>

            <script>
                async function testLocalhost() {
                    const content =
                        document.getElementById("localhost-content");
                    content.innerHTML = "<p>Testing localhost:3000...</p>";

                    try {
                        // Test different assets using fetch
                        const tests = [
                            {
                                url: "http://myapp.localhost",
                                name: "Index Page",
                            },
                            {
                                url: "http://myapp.localhostconfig.json",
                                name: "Config JSON",
                            },
                            {
                                url: "http://myapp.localhostfavicon.ico",
                                name: "Favicon",
                            },
                            {
                                url: "http://myapp.localhostlogo.png",
                                name: "Logo PNG",
                            },
                        ];

                        let results = "<ul>";
                        for (const test of tests) {
                            try {
                                const response = await fetch(test.url);
                                const status = response.ok
                                    ? "✅ Success"
                                    : "❌ Failed";
                                results += `<li>${test.name}: ${status} (${response.status})</li>`;
                            } catch (error) {
                                results += `<li>${test.name}: ❌ Error - ${error.message}</li>`;
                            }
                        }
                        results += "</ul>";
                        content.innerHTML = results;
                    } catch (error) {
                        content.innerHTML = `<p>Error: ${error.message}</p>`;
                    }
                }

                async function testIpHost() {
                    const content = document.getElementById("ip-content");
                    content.innerHTML = "<p>Testing 127.0.0.1:3000...</p>";

                    try {
                        // Test different assets using fetch
                        const tests = [
                            {
                                url: "http://127.0.0.1:3000/",
                                name: "http Index Page",
                            },
                            {
                                url: "local-assets://127.0.0.1:3000/",
                                name: "Index Page",
                            },
                            {
                                url: "local-assets://127.0.0.1:3000/config.json",
                                name: "Config JSON",
                            },
                            {
                                url: "local-assets://127.0.0.1:3000/favicon.ico",
                                name: "Favicon",
                            },
                            {
                                url: "local-assets://127.0.0.1:3000/logo.png",
                                name: "Logo PNG",
                            },
                        ];

                        let results = "<ul>";
                        for (const test of tests) {
                            try {
                                const response = await fetch(test.url);
                                const status = response.ok
                                    ? "✅ Success"
                                    : "❌ Failed";
                                results += `<li>${test.name}: ${status} (${response.status})</li>`;
                            } catch (error) {
                                results += `<li>${test.name}: ❌ Error - ${error.message}</li>`;
                            }
                        }
                        results += "</ul>";
                        content.innerHTML = results;
                    } catch (error) {
                        content.innerHTML = `<p>Error: ${error.message}</p>`;
                    }
                }

                async function testWithTauriCommand() {
                    try {
                        const result = await invoke("test_local_assets");
                        console.log("Tauri command result:", result);

                        const testResults =
                            document.getElementById("test-results");
                        let html = "<h3>Test Results from Rust:</h3>";

                        for (const [host, assets] of Object.entries(result)) {
                            html += `<div class="results-section">`;
                            html += `<h4>${host} Results:</h4>`;
                            html += `<ul>`;
                            for (const [name, url] of Object.entries(assets)) {
                                html += `<li>${name}: ${url}</li>`;
                            }
                            html += `</ul></div>`;
                        }

                        testResults.innerHTML = html;
                    } catch (error) {
                        console.error("Error calling Tauri command:", error);
                        document.getElementById("test-results").innerHTML =
                            `<p>Error: ${error.message}</p>`;
                    }
                }
            </script>
        </main>
    </body>
</html>
